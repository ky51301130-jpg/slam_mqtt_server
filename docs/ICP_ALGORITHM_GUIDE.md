# ICP (Iterative Closest Point) ì•Œê³ ë¦¬ì¦˜ ê°€ì´ë“œ

## ğŸ“Œ ê°œìš”

ICP(Iterative Closest Point)ëŠ” ë‘ ê°œì˜ í¬ì¸íŠ¸ í´ë¼ìš°ë“œ(ì  ì§‘í•©)ë¥¼ ì •ë ¬í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì…ë‹ˆë‹¤.  
ìš°ë¦¬ ì‹œìŠ¤í…œì—ì„œëŠ” **8ê°œì˜ SLAM ë§µì„ í•˜ë‚˜ë¡œ í†µí•©**í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.

---

## ğŸ¯ ì•Œê³ ë¦¬ì¦˜ ëª©í‘œ

> "ê¸°ì¤€ ë§µ(Reference Map)ì— ëŒ€í•´ íƒ€ê²Ÿ ë§µ(Target Map)ì„ **ìµœì ì˜ íšŒì „ê°**ìœ¼ë¡œ ì •ë ¬"

### ì™œ í•„ìš”í•œê°€?

ë¡œë´‡ì´ 8ë²ˆì˜ ì‚¬ì´í´ ë™ì•ˆ SLAMì„ ìˆ˜í–‰í•˜ë©´:
- ê° ë§µì€ **ë‹¤ë¥¸ ì‹œì‘ ê°ë„**ì—ì„œ ìƒì„±ë¨ (0Â°, 45Â°, 90Â°, ...)
- SLAM ì˜¤ì°¨ë¡œ ì¸í•´ ë§µ ê°„ **ë¯¸ì„¸í•œ íšŒì „ ì˜¤ì°¨** ë°œìƒ
- ë‹¨ìˆœ ì˜¤ë²„ë ˆì´ ì‹œ **ë²½ì´ ë‘ê»ê±°ë‚˜ íë¦¿í•˜ê²Œ** ë³´ì„

ICPë¡œ ì •ë°€ íšŒì „ ì •ë ¬ í›„ ë³‘í•©í•˜ë©´ **ì„ ëª…í•œ ë²½**ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ”§ ìš°ë¦¬ ì‹œìŠ¤í…œì˜ ICP êµ¬í˜„

### 1. ë²½ í”½ì…€ ì¶”ì¶œ (Wall Point Extraction)

```python
def _get_wall_points(self, m):
    """ë§µì—ì„œ ë²½(ê²€ì€ìƒ‰, ê°’=0) í”½ì…€ ì¢Œí‘œ ì¶”ì¶œ"""
    pts = np.argwhere(m == 0)[:, ::-1].astype(np.float32)  # (x, y) í˜•ì‹
    return pts
```

- ë§µ ì´ë¯¸ì§€ì—ì„œ **ë²½(0ê°’)** í”½ì…€ë§Œ ì¶”ì¶œ
- ì¢Œí‘œë¥¼ (y, x) â†’ (x, y)ë¡œ ë³€í™˜

### 2. ì¤‘ì‹¬ì  ì´ë™ (Centroid Centering)

```python
ref_center = np.mean(ref_pts, axis=0)  # ê¸°ì¤€ ë§µ ë²½ë“¤ì˜ ì¤‘ì‹¬
tgt_center = np.mean(tgt_pts, axis=0)  # íƒ€ê²Ÿ ë§µ ë²½ë“¤ì˜ ì¤‘ì‹¬

ref_centered = ref_pts - ref_center    # ì¤‘ì‹¬ ê¸°ì¤€ ì¢Œí‘œë¡œ ë³€í™˜
tgt_centered = tgt_pts - tgt_center
```

- ê° ë§µì˜ ë²½ ì¤‘ì‹¬ì„ **ì›ì (0, 0)**ìœ¼ë¡œ ì´ë™
- ì´ë¥¼ í†µí•´ **íšŒì „ë§Œ** ë¹„êµ ê°€ëŠ¥ (ì´ë™ ì œê±°)

### 3. íšŒì „ê° íƒìƒ‰ (Rotation Search)

```
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚        ê±°ì¹œ íƒìƒ‰ (Coarse Search)          â”‚
       â”‚  -180Â° ~ +180Â°, 3Â° ê°„ê²© (120ê°œ ê°ë„)      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚        ì •ë°€ íƒìƒ‰ (Fine Search)            â”‚
       â”‚  ìµœì ê°ë„ Â±4Â°, 1Â° ê°„ê²© (9ê°œ ê°ë„)          â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ê±°ì¹œ íƒìƒ‰ (3Â° ë‹¨ìœ„)
```python
for angle_deg in range(-180, 180, 3):
    angle_rad = np.radians(angle_deg)
    cos_a, sin_a = np.cos(angle_rad), np.sin(angle_rad)
    
    # ì´ë¯¸ì§€ ì¢Œí‘œê³„ íšŒì „ í–‰ë ¬ (Yì¶•ì´ ì•„ë˜ë¡œ í–¥í•¨)
    rot_matrix = np.array([[cos_a, sin_a], 
                           [-sin_a, cos_a]])
    rotated = tgt_centered @ rot_matrix.T
```

#### ì •ë°€ íƒìƒ‰ (1Â° ë‹¨ìœ„)
```python
for angle_deg in range(coarse_best - 4, coarse_best + 5):
    # ë™ì¼í•œ íšŒì „ ë° ê²¹ì¹¨ ê³„ì‚°
```

### 4. ê²¹ì¹¨ ë¹„ìœ¨ ê³„ì‚° (Overlap Ratio)

```python
overlap_threshold = 2.0  # 2í”½ì…€ ì´ë‚´ë©´ ê²¹ì¹¨ìœ¼ë¡œ ì¸ì •

for pt in rotated:
    dists = np.linalg.norm(ref_centered - pt, axis=1)
    if np.min(dists) <= overlap_threshold:
        overlap_count += 1

overlap_ratio = overlap_count / len(rotated)  # 0.0 ~ 1.0
```

**í•µì‹¬ ì•„ì´ë””ì–´:**
- íšŒì „ëœ íƒ€ê²Ÿ ë§µì˜ ê° ë²½ ì ì— ëŒ€í•´
- ê¸°ì¤€ ë§µì—ì„œ **ê°€ì¥ ê°€ê¹Œìš´ ì **ê¹Œì§€ì˜ ê±°ë¦¬ ê³„ì‚°
- ê±°ë¦¬ê°€ 2í”½ì…€ ì´ë‚´ë©´ "ê²¹ì¹¨"ìœ¼ë¡œ íŒì •
- ê²¹ì¹¨ ë¹„ìœ¨ì´ **ìµœëŒ€**ì¸ ê°ë„ = **ìµœì  íšŒì „ê°**

---

## ğŸ“Š ì•Œê³ ë¦¬ì¦˜ íë¦„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        8ê°œ SLAM ë§µ ì…ë ¥                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: ì²« ë²ˆì§¸ ë§µì„ ê¸°ì¤€(Reference)ìœ¼ë¡œ ì„¤ì •                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: ê° ë§µì—ì„œ ë²½ í”½ì…€ ì¢Œí‘œ ì¶”ì¶œ                                 â”‚
â”‚         ref_pts = get_wall_points(map[0])                       â”‚
â”‚         tgt_pts = get_wall_points(map[i])                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: ì¤‘ì‹¬ì  ê¸°ì¤€ìœ¼ë¡œ ì¢Œí‘œ ì •ê·œí™”                                 â”‚
â”‚         centered = pts - mean(pts)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: ê±°ì¹œ íƒìƒ‰ (3Â° ë‹¨ìœ„, -180Â° ~ +180Â°)                        â”‚
â”‚         â†’ ìµœëŒ€ ê²¹ì¹¨ ë¹„ìœ¨ì˜ ê°ë„ ì°¾ê¸°                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: ì •ë°€ íƒìƒ‰ (1Â° ë‹¨ìœ„, ìµœì ê°ë„ Â±4Â°)                          â”‚
â”‚         â†’ ìµœì¢… ìµœì  íšŒì „ê° ê²°ì •                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: ë§µ íšŒì „ ì ìš©                                              â”‚
â”‚         cv2.warpAffine(map, rotation_matrix)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: ê³¼ë°˜ìˆ˜ íˆ¬í‘œë¡œ ìµœì¢… ë§µ ìƒì„±                                  â”‚
â”‚         5ê°œ ì´ìƒ ë§µì—ì„œ ë²½ â†’ ìµœì¢… ë²½                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§® ìˆ˜í•™ì  ë°°ê²½

### 2D íšŒì „ í–‰ë ¬

ì¼ë°˜ì ì¸ 2D íšŒì „ í–‰ë ¬ (ë°˜ì‹œê³„ ë°©í–¥):
$$
R(\theta) = \begin{bmatrix} \cos\theta & -\sin\theta \\ \sin\theta & \cos\theta \end{bmatrix}
$$

**ì´ë¯¸ì§€ ì¢Œí‘œê³„** (Yì¶•ì´ ì•„ë˜ë¡œ):
$$
R_{img}(\theta) = \begin{bmatrix} \cos\theta & \sin\theta \\ -\sin\theta & \cos\theta \end{bmatrix}
$$

### ê²¹ì¹¨ ë¹„ìœ¨ (Overlap Ratio)

$$
\text{Overlap Ratio} = \frac{\sum_{p \in T'} \mathbf{1}[\min_{q \in R} \|p - q\| \leq \epsilon]}{|T'|}
$$

- $T'$: íšŒì „ëœ íƒ€ê²Ÿ í¬ì¸íŠ¸ ì§‘í•©
- $R$: ê¸°ì¤€ í¬ì¸íŠ¸ ì§‘í•©
- $\epsilon$: í—ˆìš© ê±°ë¦¬ (2 í”½ì…€)
- $\mathbf{1}[\cdot]$: ì¡°ê±´ì´ ì°¸ì´ë©´ 1, ê±°ì§“ì´ë©´ 0

---

## ğŸ” í‘œì¤€ ICPì™€ì˜ ì°¨ì´ì 

| êµ¬ë¶„ | í‘œì¤€ ICP | ìš°ë¦¬ êµ¬í˜„ |
|------|---------|----------|
| **íƒìƒ‰ ë°©ì‹** | ë°˜ë³µì  ìˆ˜ë ´ (iterative) | ì „ì²´ ê°ë„ íƒìƒ‰ (brute-force) |
| **ë³€í™˜ ì¢…ë¥˜** | íšŒì „ + ì´ë™ (6 DOF) | íšŒì „ë§Œ (1 DOF) |
| **ì •í•© ë©”íŠ¸ë¦­** | í‰ê·  ê±°ë¦¬ ìµœì†Œí™” | ê²¹ì¹¨ ë¹„ìœ¨ ìµœëŒ€í™” |
| **ì†ë„** | ë¹ ë¦„ | ëŠë¦¼ (í•˜ì§€ë§Œ ì •í™•) |
| **ë¡œì»¬ ë¯¸ë‹ˆë§ˆ** | ë¹ ì§€ê¸° ì‰¬ì›€ | ì—†ìŒ (ì „ì—­ íƒìƒ‰) |

### ì™œ í‘œì¤€ ICPë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ëŠ”ê°€?

1. **ë¡œì»¬ ë¯¸ë‹ˆë§ˆ ë¬¸ì œ**: í‘œì¤€ ICPëŠ” ì´ˆê¸°ê°’ì— ë¯¼ê°
2. **íšŒì „ë§Œ í•„ìš”**: ìš°ë¦¬ ì‹œìŠ¤í…œì€ ì¤‘ì‹¬ ì •ë ¬ í›„ íšŒì „ë§Œ íƒìƒ‰
3. **8ê°œ ë§µë§Œ ì²˜ë¦¬**: ì‹¤ì‹œê°„ ì„±ëŠ¥ì´ í¬ê²Œ ì¤‘ìš”í•˜ì§€ ì•ŠìŒ
4. **í™•ì‹¤í•œ ê²°ê³¼**: ì „ì²´ íƒìƒ‰ìœ¼ë¡œ ìµœì í•´ ë³´ì¥

---

## ğŸ“ˆ ì„±ëŠ¥ ë¶„ì„

### ì‹œê°„ ë³µì¡ë„

- ê±°ì¹œ íƒìƒ‰: $O(120 \times N \times M)$
- ì •ë°€ íƒìƒ‰: $O(9 \times N \times M)$
- ì´: $O(129 \times N \times M)$ where N, M = ë²½ ì  ê°œìˆ˜

### ì‹¤ì œ ì„±ëŠ¥ (ì˜ˆì‹œ)

```
Map Size: 1000x1000 pixels
Wall Points: ~5000 points
Processing Time: ~2-5 seconds per map
Total (8 maps): ~15-40 seconds
```

---

## âš ï¸ í˜„ì¬ êµ¬í˜„ì˜ í•œê³„

### 1. Localization - ì´ì œ ì§€ì›ë¨! âœ…

í˜„ì¬ ì‹œìŠ¤í…œì€ **ì™„ì „í•œ Map Building + Localization íŒŒì´í”„ë¼ì¸**ì„ ì§€ì›í•©ë‹ˆë‹¤:

```
âœ… Map Alignment (ë§µ ì •ë ¬) = ICP ì•Œê³ ë¦¬ì¦˜
âœ… Map Merging (ë§µ ë³‘í•©) = ê³¼ë°˜ìˆ˜ íˆ¬í‘œ
âœ… Map Distribution (ë§µ ë°°í¬) = HTTP ì„œë²„ + MQTT ì•Œë¦¼
âœ… Localization (ìœ„ì¹˜ ì¶”ì •) = AMCL (ë¡œë´‡ì—ì„œ ì‹¤í–‰)
```

### ì‹œìŠ¤í…œ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì„œë²„ (192.168.0.3)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. SLAM ë§µ ìˆ˜ì§‘ (8ê°œ ì‚¬ì´í´)                                      â”‚
â”‚  2. ICP íšŒì „ ì •ë ¬ + ê³¼ë°˜ìˆ˜ íˆ¬í‘œ â†’ ìµœì¢… ë§µ ìƒì„±                       â”‚
â”‚  3. HTTP ì„œë²„ì—ì„œ ë§µ íŒŒì¼ ì œê³µ (í¬íŠ¸ 5100)                          â”‚
â”‚  4. MQTTë¡œ ë¡œë´‡ì— "map_ready" ì•Œë¦¼                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                      MQTT: robot/map_ready
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ë¡œë´‡ (192.168.0.5)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. MQTTë¡œ map_ready ìˆ˜ì‹                                         â”‚
â”‚  2. HTTPë¡œ ë§µ íŒŒì¼ ë‹¤ìš´ë¡œë“œ (PGM + YAML)                           â”‚
â”‚  3. map_server ì‹œì‘ â†’ /map í† í”½ ë°œí–‰                              â”‚
â”‚  4. AMCL ì‹œì‘ â†’ Localization ìˆ˜í–‰                                â”‚
â”‚  5. Nav2 ë„¤ë¹„ê²Œì´ì…˜ ì‚¬ìš© ê°€ëŠ¥!                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ì´ë™(Translation) ì •ë ¬ ë¯¸ì§€ì›

- í˜„ì¬ëŠ” **ì¤‘ì‹¬ì  ê¸°ì¤€** ì •ë ¬ë§Œ ìˆ˜í–‰
- ë§µ ê°„ ìœ„ì¹˜ ì˜¤ì°¨ê°€ í¬ë©´ ì •ë ¬ í’ˆì§ˆ ì €í•˜

### 3. íšŒì „ ê°ë„ ì œí•œ

- 1ë„ ë‹¨ìœ„ ì •ë°€ë„
- 0.1ë„ ì´í•˜ì˜ ë¯¸ì„¸ ì •ë ¬ ë¶ˆê°€

---

## ğŸ› ï¸ ì‹œìŠ¤í…œ êµ¬ì„±ìš”ì†Œ

### ì„œë²„ ì¸¡ (192.168.0.3)

| íŒŒì¼ | ì—­í•  |
|------|------|
| `nav2_map_builder_with_alignment.py` | ICP ë§µ ì •ë ¬ + ë³‘í•© |
| `map_http_server.py` | ë§µ íŒŒì¼ HTTP ì œê³µ (í¬íŠ¸ 5100) |
| `server_mqtt_bridge.py` | MQTT ë¸Œë¦¿ì§€ + ë§µ ì•Œë¦¼ |

### ë¡œë´‡ ì¸¡ (192.168.0.5)

| íŒŒì¼ | ì—­í•  |
|------|------|
| `robot_map_loader.py` | ë§µ ë‹¤ìš´ë¡œë“œ + AMCL ì‹œì‘ |
| `robot_nav2_action_client.py` | Nav2 ë„¤ë¹„ê²Œì´ì…˜ ëª…ë ¹ ì²˜ë¦¬ |

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. ì„œë²„ì—ì„œ ì‹¤í–‰

```bash
# í„°ë¯¸ë„ 1: ROS2 ë…¸ë“œë“¤
ros2 launch slam_mqtt_project server_launch.py

# í„°ë¯¸ë„ 2: ë§µ HTTP ì„œë²„
python3 ~/ros2_ws/src/slam_mqtt_project/slam_mqtt_project/map_http_server.py
```

### 2. ë¡œë´‡ì—ì„œ ì‹¤í–‰

```bash
# í„°ë¯¸ë„ 1: ë§µ ë¡œë” (AMCL ìë™ ì‹œì‘)
python3 ~/robot_files/robot_map_loader.py

# í„°ë¯¸ë„ 2: Nav2 Action Client
python3 ~/robot_files/robot_nav2_action_client.py
```

### 3. ì›Œí¬í”Œë¡œìš°

1. SLAM ì™„ë£Œ â†’ 8ê°œ ë§µ ìˆ˜ì§‘
2. ì„œë²„: ICP ì •ë ¬ â†’ ìµœì¢… ë§µ ìƒì„±
3. ì„œë²„: MQTT `robot/map_ready` ë°œí–‰
4. ë¡œë´‡: ë§µ ë‹¤ìš´ë¡œë“œ â†’ AMCL ì‹œì‘
5. ë¡œë´‡: Localization ì™„ë£Œ â†’ ë„¤ë¹„ê²Œì´ì…˜ ê°€ëŠ¥!
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

1. [ICP Algorithm - Wikipedia](https://en.wikipedia.org/wiki/Iterative_closest_point)
2. [Point Cloud Registration - PCL](https://pointclouds.org/documentation/tutorials/registration_api.html)
3. [AMCL - Nav2 Documentation](https://navigation.ros.org/configuration/packages/configuring-amcl.html)
4. [OpenCV Geometric Transformations](https://docs.opencv.org/master/da/d6e/tutorial_py_geometric_transformations.html)

---

## ğŸ“ ìš”ì•½

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì•Œê³ ë¦¬ì¦˜ ì´ë¦„** | ICP ê¸°ë°˜ íšŒì „ ì •ë ¬ (Rotation-Only ICP) |
| **ì…ë ¥** | 8ê°œ SLAM ë§µ ì´ë¯¸ì§€ |
| **ì¶œë ¥** | ì •ë ¬/ë³‘í•©ëœ ë‹¨ì¼ ë§µ |
| **íƒìƒ‰ ë²”ìœ„** | -180Â° ~ +180Â° |
| **ì •ë°€ë„** | 1Â° |
| **Map Building** | âœ… ì§€ì› (ì„œë²„ì—ì„œ ìˆ˜í–‰) |
| **Map Distribution** | âœ… ì§€ì› (HTTP + MQTT) |
| **Localization** | âœ… ì§€ì› (ë¡œë´‡ì—ì„œ AMCL ì‚¬ìš©) |

---

## ğŸ“¡ MQTT í† í”½

| í† í”½ | ë°©í–¥ | ë‚´ìš© |
|------|------|------|
| `robot/map_ready` | ì„œë²„ â†’ ë¡œë´‡ | ë§µ ë¹Œë“œ ì™„ë£Œ ì•Œë¦¼ + ë‹¤ìš´ë¡œë“œ URL |
| `robot/localization_status` | ë¡œë´‡ ë°œí–‰ | Localization ìƒíƒœ |
| `robot/navigate_to_pose` | ì„œë²„ â†’ ë¡œë´‡ | ë„¤ë¹„ê²Œì´ì…˜ ëª…ë ¹ |
| `robot/nav_result` | ë¡œë´‡ â†’ ì„œë²„ | ë„¤ë¹„ê²Œì´ì…˜ ê²°ê³¼ |
