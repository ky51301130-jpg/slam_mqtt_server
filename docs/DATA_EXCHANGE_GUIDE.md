# ë°ì´í„° êµí™˜ ì•„í‚¤í…ì²˜ ê°€ì´ë“œ

## ğŸ“Œ ê°œìš”

ì´ ë¬¸ì„œëŠ” ì„œë²„-ë¡œë´‡ ê°„ ë°ì´í„° êµí™˜ ë°©ì‹ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

**í•µì‹¬ ì›ì¹™:**
- **MQTT**: ì‘ì€ ë©”ì‹œì§€/ì•Œë¦¼ ì „ì†¡ (< 256KB)
- **HTTP**: ëŒ€ìš©ëŸ‰ íŒŒì¼ ì „ì†¡ (ì‚¬ì§„, ë§µ íŒŒì¼)

---

## ğŸ”„ ë°ì´í„° êµí™˜ ìš”ì•½

| ë°ì´í„° | í¬ê¸° | ë°©í–¥ | ì „ì†¡ ë°©ì‹ | í¬íŠ¸ |
|--------|------|------|----------|------|
| ì„¼ì„œ ë°ì´í„° | ~100B | MCU â†’ ì„œë²„ | MQTT | 1883 |
| PLC ëª…ë ¹ | ~200B | PLC â†’ ì„œë²„ â†’ ë¡œë´‡ | MQTT | 1883 |
| ë„¤ë¹„ê²Œì´ì…˜ ëª…ë ¹ | ~300B | ì„œë²„ â†’ ë¡œë´‡ | MQTT | 1883 |
| ë„¤ë¹„ê²Œì´ì…˜ ê²°ê³¼ | ~500B | ë¡œë´‡ â†’ ì„œë²„ | MQTT | 1883 |
| **ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼** | ~100KB/frame | ë¡œë´‡ â†’ ì„œë²„ | **HTTP** | 5000 |
| **ì¶©ëŒ ì‚¬ì§„** | ~1MB | ë¡œë´‡ â†’ ì„œë²„ | **MQTT ì•Œë¦¼ + HTTP** | 5001 |
| **ë§µ íŒŒì¼** | ~1-5MB | ì„œë²„ â†’ ë¡œë´‡ | **MQTT ì•Œë¦¼ + HTTP** | 5100 |

---

## ğŸ“Š ìƒì„¸ ë°ì´í„° íë¦„

### 1. ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ (ë¡œë´‡ â†’ ì„œë²„)

```
ë¡œë´‡ (192.168.0.5:5000)                  ì„œë²„ (192.168.0.3)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Flask HTTP Server                        ai_vision_analyzer.py
    â”‚                                         â”‚
    â”‚  GET /image.jpg                         â”‚
    â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                                         â”‚
    â”‚         JPEG (~100KB)                   â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                                         â”‚
                                         ArUco/YOLO ë¶„ì„
```

**íŠ¹ì§•:**
- 1ì´ˆì— 1í”„ë ˆì„ ìš”ì²­ (1 FPS)
- ë¡œë´‡ì´ í•­ìƒ ìµœì‹  í”„ë ˆì„ ì œê³µ
- ì„œë²„ê°€ í•„ìš”í•  ë•Œë§Œ ìš”ì²­ (pull ë°©ì‹)

---

### 2. ì¶©ëŒ ì‚¬ì§„ (ë¡œë´‡ â†’ ì„œë²„)

```
ë¡œë´‡                                      ì„œë²„
â”â”â”â”                                      â”â”â”â”
1. ì¶©ëŒ ê°ì§€ (ì„¼ì„œ)
   â”‚
2. ì‚¬ì§„ ì´¬ì˜ â†’ ë¡œì»¬ ì €ì¥
   â”‚
3. MQTT ì•Œë¦¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
   {"event": "collision_photo",
    "url": "http://192.168.0.5:5001/download/collision_xxx.jpg"}
                                          â”‚
                                     4. HTTP GET
   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                                          â”‚
   JPEG (1MB) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
                                          â”‚
                                     5. ì €ì¥: /home/kim1/save/collision/
```

**ì™œ MQTTë¡œ íŒŒì¼ì„ ì§ì ‘ ë³´ë‚´ì§€ ì•Šë‚˜?**
- MQTT ê¶Œì¥ ë©”ì‹œì§€ í¬ê¸°: 256KB ì´í•˜
- 1MB ì‚¬ì§„ ì „ì†¡ ì‹œ ë¸Œë¡œì»¤ ë¶€í•˜ ì¦ê°€
- ì—°ê²° ë¶ˆì•ˆì • ì‹œ ì¬ì „ì†¡ ì–´ë ¤ì›€

---

### 3. ë§µ íŒŒì¼ (ì„œë²„ â†’ ë¡œë´‡)

```
ì„œë²„ (192.168.0.3)                        ë¡œë´‡ (192.168.0.5)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                        â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. ICP ë§µ ì •ë ¬ + ê³¼ë°˜ìˆ˜ íˆ¬í‘œ
   â”‚
2. ìµœì¢… ë§µ ì €ì¥ (PGM + YAML)
   â”‚
3. MQTT ì•Œë¦¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
   {"event": "map_ready",
    "download_url": {
      "yaml": "http://192.168.0.3:5100/download/xxx.yaml",
      "pgm": "http://192.168.0.3:5100/download/xxx.pgm"
    }}
                                          â”‚
                                     4. HTTP GET (YAML)
   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   YAML (~1KB) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
                                          â”‚
                                     5. HTTP GET (PGM)
   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   PGM (~1-5MB) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
                                          â”‚
                                     6. AMCL ì‹œì‘ â†’ Localization
```

---

## ğŸ–¥ï¸ HTTP ì„œë²„ ëª©ë¡

### ë¡œë´‡ ì¸¡ (192.168.0.5)

| í¬íŠ¸ | ì„œë¹„ìŠ¤ | íŒŒì¼ | ì—­í•  |
|------|--------|------|------|
| 5000 | ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ | (ê¸°ì¡´) | `/image.jpg` ì œê³µ |
| 5001 | ì¶©ëŒ ì‚¬ì§„ | `robot_collision_photo_server.py` | `/download/<filename>` |

### ì„œë²„ ì¸¡ (192.168.0.3)

| í¬íŠ¸ | ì„œë¹„ìŠ¤ | íŒŒì¼ | ì—­í•  |
|------|--------|------|------|
| 5100 | ë§µ íŒŒì¼ | `map_http_server.py` | `/download/<filename>` |

---

## ğŸ“¡ MQTT í† í”½ ëª©ë¡

### ì•Œë¦¼ ì „ìš© (íŒŒì¼ URL í¬í•¨)

| í† í”½ | ë°©í–¥ | ë‚´ìš© |
|------|------|------|
| `collision/photo_ready` | ë¡œë´‡ â†’ ì„œë²„ | ì¶©ëŒ ì‚¬ì§„ URL |
| `robot/map_ready` | ì„œë²„ â†’ ë¡œë´‡ | ë§µ íŒŒì¼ URL |

### ëª…ë ¹/ìƒíƒœ

| í† í”½ | ë°©í–¥ | ë‚´ìš© |
|------|------|------|
| `robot/navigate_to_pose` | ì„œë²„ â†’ ë¡œë´‡ | ë„¤ë¹„ê²Œì´ì…˜ ëª…ë ¹ |
| `robot/nav_result` | ë¡œë´‡ â†’ ì„œë²„ | ë„¤ë¹„ê²Œì´ì…˜ ê²°ê³¼ |
| `/plc/location` | PLC â†’ ì„œë²„ | ìœ„ì¹˜ ëª…ë ¹ |
| `/mcu/#` | MCU â†’ ì„œë²„ | ì„¼ì„œ ë°ì´í„° |

---

## ğŸš€ ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë¡œë´‡ (192.168.0.5)

```bash
# 1. ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ì„œë²„ (ê¸°ì¡´)
python3 ~/camera_server.py  # í¬íŠ¸ 5000

# 2. ì¶©ëŒ ì‚¬ì§„ ì„œë²„
python3 ~/robot_files/robot_collision_photo_server.py  # í¬íŠ¸ 5001

# 3. ë§µ ë¡œë” + AMCL
python3 ~/robot_files/robot_map_loader.py

# 4. Nav2 Action Client
python3 ~/robot_files/robot_nav2_action_client.py
```

### ì„œë²„ (192.168.0.3)

```bash
# 1. ROS2 ë…¸ë“œë“¤
ros2 launch slam_mqtt_project server_launch.py

# 2. ë§µ HTTP ì„œë²„
python3 ~/ros2_ws/src/slam_mqtt_project/slam_mqtt_project/map_http_server.py
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### MQTT ë©”ì‹œì§€ í¬ê¸°

- **ê¶Œì¥**: 256KB ì´í•˜
- **ìµœëŒ€**: ëŒ€ë¶€ë¶„ ë¸Œë¡œì»¤ê°€ 1MB ì œí•œ
- **í•´ê²°ì±…**: URLë§Œ ì „ì†¡ â†’ HTTPë¡œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ

### ë„¤íŠ¸ì›Œí¬ ì¥ì•  ëŒ€ì‘

```python
# HTTP ë‹¤ìš´ë¡œë“œ ì‹œ ì¬ì‹œë„ ë¡œì§ (ê¶Œì¥)
import requests
from requests.adapters import HTTPAdapter
from urllib3.util.retry import Retry

session = requests.Session()
retry = Retry(total=3, backoff_factor=0.5)
adapter = HTTPAdapter(max_retries=retry)
session.mount('http://', adapter)

response = session.get(url, timeout=30)
```

### ëŒ€ì—­í­ ê´€ë¦¬

- ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼: 1 FPS (ì¡°ì ˆ ê°€ëŠ¥)
- ë§µ íŒŒì¼: ë¹Œë“œ ì™„ë£Œ ì‹œì—ë§Œ ì „ì†¡
- ì¶©ëŒ ì‚¬ì§„: ì´ë²¤íŠ¸ ë°œìƒ ì‹œì—ë§Œ

---

## ğŸ“ˆ ë°ì´í„° í¬ê¸° ì¶”ì •

| ë°ì´í„° | í•´ìƒë„ | ì••ì¶• | í¬ê¸° |
|--------|--------|------|------|
| ì¹´ë©”ë¼ í”„ë ˆì„ | 640x480 | JPEG 80% | ~50-100KB |
| ì¶©ëŒ ì‚¬ì§„ | 1920x1080 | JPEG 90% | ~500KB-1MB |
| ë§µ PGM | 1000x1000 | ë¬´ì••ì¶• | ~1MB |
| ë§µ YAML | - | í…ìŠ¤íŠ¸ | ~500B |

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

### 1. ì¶©ëŒ ì‚¬ì§„ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨

```bash
# ë¡œë´‡ì—ì„œ í™•ì¸
curl http://192.168.0.5:5001/list

# ì„œë²„ì—ì„œ ë‹¤ìš´ë¡œë“œ í…ŒìŠ¤íŠ¸
curl http://192.168.0.5:5001/download/collision_xxx.jpg -o test.jpg
```

### 2. ë§µ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨

```bash
# ì„œë²„ì—ì„œ í™•ì¸
curl http://192.168.0.3:5100/list

# ë¡œë´‡ì—ì„œ ë‹¤ìš´ë¡œë“œ í…ŒìŠ¤íŠ¸
curl http://192.168.0.3:5100/latest
curl http://192.168.0.3:5100/download/nav2_final_map_xxx.yaml -o test.yaml
```

### 3. MQTT ì—°ê²° í™•ì¸

```bash
# ë¸Œë¡œì»¤ ìƒíƒœ í™•ì¸
mosquitto_sub -h 192.168.0.3 -t "#" -v

# íŠ¹ì • í† í”½ êµ¬ë…
mosquitto_sub -h 192.168.0.3 -t "collision/photo_ready" -v
mosquitto_sub -h 192.168.0.3 -t "robot/map_ready" -v
```
