# Telegraf Configuration for SLAM MQTT Project
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# MQTT 토픽을 InfluxDB로 전송하여 Grafana에서 시각화
#
# 설치:
#   sudo cp telegraf.conf /etc/telegraf/telegraf.conf
#   sudo systemctl restart telegraf
#
# 확인:
#   sudo systemctl status telegraf
#   telegraf --test --config /etc/telegraf/telegraf.conf
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[global_tags]
  project = "slam_mqtt"
  location = "server"

[agent]
  interval = "1s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "1s"
  flush_jitter = "0s"
  precision = ""
  hostname = "slam-server"
  omit_hostname = false

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# OUTPUT: InfluxDB v2.x
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[[outputs.influxdb_v2]]
  urls = ["http://localhost:8086"]
  token = "$INFLUX_TOKEN"
  organization = "slam_org"
  bucket = "slam_data"
  timeout = "5s"

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# INPUTS: MQTT 토픽별 구독
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# MCU 센서 데이터
[[inputs.mqtt_consumer]]
  servers = ["tcp://localhost:1883"]
  topics = ["/mcu/sensors"]
  data_format = "json"
  name_override = "mcu_sensors"
  [inputs.mqtt_consumer.tags]
    device = "mcu"

# PLC 위치/목표/상태
[[inputs.mqtt_consumer]]
  servers = ["tcp://localhost:1883"]
  topics = ["/plc/#"]
  data_format = "json"
  name_override = "plc_data"
  [inputs.mqtt_consumer.tags]
    device = "plc"

# 네트워크 연결 상태
[[inputs.mqtt_consumer]]
  servers = ["tcp://localhost:1883"]
  topics = ["network/connectivity"]
  data_format = "json"
  name_override = "network_status"

# 로봇 상태 (모드, Nav2, 배터리)
[[inputs.mqtt_consumer]]
  servers = ["tcp://localhost:1883"]
  topics = ["robot/#", "nav2/#", "battery/#"]
  data_format = "json"
  name_override = "robot_status"
  [inputs.mqtt_consumer.tags]
    device = "robot"

# AI 비전 (ArUco, 장애물)
[[inputs.mqtt_consumer]]
  servers = ["tcp://localhost:1883"]
  topics = ["mqtt/pinky/#"]
  data_format = "json"
  name_override = "ai_vision"
  [inputs.mqtt_consumer.tags]
    source = "ai_vision_analyzer"

# 충돌 및 이벤트
[[inputs.mqtt_consumer]]
  servers = ["tcp://localhost:1883"]
  topics = ["collision/#", "qr_detected"]
  data_format = "json"
  name_override = "robot_events"

# 시스템 메트릭
[[inputs.cpu]]
[[inputs.mem]]
[[inputs.disk]]
[[inputs.net]]
